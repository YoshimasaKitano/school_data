# 図書館管理システム(CLI) 外部設計書

## 1. システム概要

本システムは、Pythonによるコンソールベースの図書館管理ツールであり、管理者と一般ユーザーがそれぞれの権限で図書館の蔵書を操作・利用できる。データはJSONファイルに保存され、管理される。


## 2. 画面設計（メニュー構成）

### 2.1 メインメニュー

```
** 図書館システム **
1. 管理者モード
2. ユーザーモード
3. 終了
選択: [1-3]
```

### 2.2 管理者メニュー

```
@管理者メニュー
1. 本を追加
2. 本を検索
3. 本を削除
4. 本を更新
5. 戻る
選択: [1-5]
```

### 2.3 ユーザーメニュー

```
@ユーザー: [ユーザー名]
1. 本を借りる
2. 本を返却する
3. 貸出履歴を見る
4. 戻る
選択: [1-4]
```


## 3. 入出力仕様

### 3.1 入力項目一覧

| 操作           | 入力項目       | 型     | 必須 | 備考 |
|----------------|----------------|--------|------|------|
| 本の追加       | タイトル       | str    | ○    | 一意である必要あり |
|                | 著者名         | str    | ○    | 任意の文字列       |
| 本の検索       | キーワード     | str    | ○    | 部分一致検索       |
| 本の削除       | タイトル       | str    | ○    | 存在チェックあり   |
| 本の更新       | タイトル       | str    | ○    | 存在チェックあり   |
|                | 新しい著者名   | str    | ○    | 任意の文字列       |
| ユーザー登録   | ユーザー名     | str    | ○    | 新規または既存     |
| 本の貸出       | タイトル       | str    | ○    | 貸出可能か確認     |
| 本の返却       | タイトル       | str    | ○    | 借りているか確認   |

### 3.2 出力内容一覧

| 操作           | 出力内容                             |
|----------------|--------------------------------------|
| 本の追加       | 「追加しました。」または「すでに登録されています。」 |
| 本の検索       | タイトル、著者、貸出状況の一覧表示     |
| 本の削除       | 「削除しました。」または「見つかりません。」 |
| 本の更新       | 「更新しました。」または「見つかりません。」 |
| ユーザー登録   | 「新規ユーザー登録しました。」         |
| 本の貸出       | 「貸出しました。」または「貸出できません。」 |
| 本の返却       | 「返却しました。」または「借りていません。」 |
| 履歴確認       | 現在借りている本の一覧表示             |


## 4. ファイル設計

### 4.1 books.json

- 蔵書情報を保持するファイル
- 構造：

```json
{
  "タイトル": {
    "author": "著者名",
    "available": true
  }
}
```

### 4.2 users.json

- ユーザー情報と貸出履歴を保持するファイル
- 構造：

```json
{
  "ユーザー名": {
    "borrowed": ["タイトル1", "タイトル2"]
  }
}
```


## 5. データ設計

### 5.1 本データ（辞書型）

```python
books = {
    "タイトル": {
        "author": "著者名",
        "available": True
    }
}
```

### 5.2 ユーザーデータ（辞書型）

```python
users = {
    "ユーザー名": {
        "borrowed": ["タイトル1", "タイトル2"]
    }
}
```


## 6. 画面遷移図

```
[メインメニュー]
 ├─> 管理者モード
 │     ├─> 本追加
 │     ├─> 本検索
 │     ├─> 本削除
 │     └─> 本更新
 └─> ユーザーモード
       ├─> ユーザー登録
       ├─> 本貸出
       ├─> 本返却
       └─> 履歴確認
```


## 7. エラーメッセージ設計

| 条件                         | メッセージ                   |
|------------------------------|------------------------------|
| 本がすでに登録されている     | 「すでに登録されています。」 |
| 本が存在しない               | 「見つかりません。」         |
| 本が貸出中                   | 「貸出できません。」         |
| 本が借りられていない         | 「その本は借りていません。」 |
| 貸出冊数が上限（3冊）に達している | 「最大3冊までです。返却してください。」 |
| メニュー選択が無効           | 「無効な選択です。」         |


## 8. 拡張性と保守性

- 関数分割により機能追加が容易
- JSON形式により他システムとの連携が可能
