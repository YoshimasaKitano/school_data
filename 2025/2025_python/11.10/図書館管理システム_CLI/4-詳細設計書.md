# 図書館管理システム(CLI) 詳細設計書

## 1. システム構成

| コンポーネント     | 説明 |
|------------------|------|
| main()           | メインメニュー表示とモード選択 |
| admin_menu()     | 管理者機能の制御 |
| user_menu()      | ユーザー機能の制御 |
| load_data()      | JSONファイル読み込み |
| save_data()      | JSONファイル保存 |
| add_book()       | 本の追加処理 |
| search_books()   | 本の検索処理 |
| delete_book()    | 本の削除処理 |
| update_book()    | 本の更新処理 |
| borrow_book()    | 本の貸出処理 |
| return_book()    | 本の返却処理 |


## 2. データ仕様

### 2.1 books.json

```json
{
  "タイトル": {
    "author": "著者名",
    "available": true
  }
}
```

- `author`: 著者名（文字列）
- `available`: 貸出可否（真偽値）

### 2.2 users.json

```json
{
  "ユーザー名": {
    "borrowed": ["タイトル1", "タイトル2"]
  }
}
```

- `borrowed`: 現在借りている本のタイトル一覧（最大3冊）


## 3. 画面設計（CLI）

### 3.1 メインメニュー

```
** 図書館システム **
1. 管理者モード
2. ユーザーモード
3. 終了
選択: [1-3]
```

### 3.2 管理者メニュー

```
@管理者メニュー
1. 本を追加
2. 本を検索
3. 本を削除
4. 本を更新
5. 戻る
選択: [1-5]
```

### 3.3 ユーザーメニュー

```
@ユーザー: [ユーザー名]
1. 本を借りる
2. 本を返却する
3. 貸出履歴を見る
4. 戻る
選択: [1-4]
```


## 4. 機能詳細

### 4.1 本の追加（add_book）

- 入力：タイトル、著者名
- 処理：
  - タイトルが既存か確認
  - 新規なら `books[title] = {"author": author, "available": True}`
- 出力：成功／重複メッセージ

### 4.2 本の検索（search_books）

- 入力：キーワード
- 処理：
  - タイトルに部分一致する本を抽出
  - 著者名と貸出状況を表示
- 出力：検索結果一覧

### 4.3 本の削除（delete_book）

- 入力：タイトル
- 処理：
  - 存在確認 → 削除
- 出力：成功／失敗メッセージ

### 4.4 本の更新（update_book）

- 入力：タイトル、新しい著者名
- 処理：
  - 存在確認 → 著者名更新
- 出力：成功／失敗メッセージ

### 4.5 本の貸出（borrow_book）

- 入力：タイトル
- 処理：
  - ユーザーの借りている冊数が3冊未満か確認
  - 本が存在し、貸出可能か確認
  - `books[title]["available"] = False`
  - `users[username]["borrowed"].append(title)`
- 出力：成功／失敗メッセージ

### 4.6 本の返却（return_book）

- 入力：タイトル
- 処理：
  - ユーザーがその本を借りているか確認
  - `books[title]["available"] = True`
  - `users[username]["borrowed"].remove(title)`
- 出力：成功／失敗メッセージ


## 5. 例外処理設計

| 処理           | 条件                     | メッセージ                     |
|----------------|--------------------------|--------------------------------|
| 本の追加       | タイトルが重複           | 「すでに登録されています。」   |
| 本の削除・更新 | タイトルが存在しない     | 「見つかりません。」           |
| 貸出処理       | 本が貸出中／存在しない   | 「貸出できません。」           |
| 返却処理       | 本が借りられていない     | 「その本は借りていません。」   |
| 貸出制限       | すでに3冊借りている      | 「最大3冊までです。」          |
| メニュー選択   | 無効な番号               | 「無効な選択です。」           |


## 6. データフロー図（DFD）

```
[ユーザー] ──┐
             │
             ▼
        [main()] ──┬─> [admin_menu()] ──┬─> [add_book()]
                    │                   ├─> [search_books()]
                    │                   ├─> [delete_book()]
                    │                   └─> [update_book()]
                    │
                    └─> [user_menu()] ──┬─> [borrow_book()]
                                        ├─> [return_book()]
                                        └─> [履歴表示]
```


## 7. 保守・拡張設計

| 項目         | 内容 |
|--------------|------|
| 関数分割     | 各機能が独立しており、追加・修正が容易 |
| データ形式   | JSON形式で他システムとの連携が可能 |
| 拡張性       | Web化、DB化への移行が容易 |
| テスト性     | 各関数単位で単体テストが可能       |

